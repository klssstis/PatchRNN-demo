From 3cece34be842178a3c5697a58e03fb4a5d576378 Mon Sep 17 00:00:00 2001
From: Tom Lane <tgl@sss.pgh.pa.us>
Date: Mon, 23 Jan 2023 13:33:19 -0500
Subject: [PATCH] Remove special outfuncs/readfuncs handling of
 RangeVar.catalogname.

Historically we skipped writing/reading this field, but that no
longer works under WRITE_READ_PARSE_PLAN_TREES since we expanded
the coverage of that option to include utility commands (787102b56).
Remove the special case and just treat this field normally.

Bump catversion out of an abundance of caution --- I do not think
we currently ever store RangeVar nodes in the catalogs, but
perhaps I'm wrong.

Per report from Pavel Stehule.

Discussion: https://postgr.es/m/CAFj8pRAYvYu-qU7-NieqRRyaQZk-yr3UjtHQ2LR62PS9M1dZMA@mail.gmail.com
---
 src/include/catalog/catversion.h | 2 +-
 src/include/nodes/primnodes.h    | 7 ++-----
 2 files changed, 3 insertions(+), 6 deletions(-)

diff --git a/src/include/catalog/catversion.h b/src/include/catalog/catversion.h
index 03be537054d2..823c70c47ccd 100644
--- a/src/include/catalog/catversion.h
+++ b/src/include/catalog/catversion.h
@@ -57,6 +57,6 @@
  */
 
 /*							yyyymmddN */
-#define CATALOG_VERSION_NO	202301231
+#define CATALOG_VERSION_NO	202301232
 
 #endif
diff --git a/src/include/nodes/primnodes.h b/src/include/nodes/primnodes.h
index 3bdde134f474..dec7d5c775fd 100644
--- a/src/include/nodes/primnodes.h
+++ b/src/include/nodes/primnodes.h
@@ -64,11 +64,8 @@ typedef struct RangeVar
 {
 	NodeTag		type;
 
-	/*
-	 * the catalog (database) name, or NULL; ignored for read/write, since it
-	 * is presently not semantically meaningful
-	 */
-	char	   *catalogname pg_node_attr(read_write_ignore, read_as(NULL));
+	/* the catalog (database) name, or NULL */
+	char	   *catalogname;
 
 	/* the schema name, or NULL */
 	char	   *schemaname;

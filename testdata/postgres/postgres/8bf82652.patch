From 8bf826528ae9ff7a543a49c0dce665fa9ec542cb Mon Sep 17 00:00:00 2001
From: Andres Freund <andres@anarazel.de>
Date: Wed, 8 Mar 2023 16:53:57 -0800
Subject: [PATCH] meson: tests: Adjust with_icu/ZSTD env vars for pg_dump,
 pg_basebackup

396d348b0 omitted adding with_icu to the pg_dump tests under
meson. Conversely, e6927270c exported ZSTD for pg_basebackup's tests, despite
pg_basebackup's ZSTD support not having any tests.

Reported-by: Justin Pryzby <pryzby@telsasoft.com>
Discussion: https://postgr.es/m/20230226225239.GL1653@telsasoft.com
---
 src/bin/pg_basebackup/meson.build | 2 +-
 src/bin/pg_dump/meson.build       | 1 +
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/bin/pg_basebackup/meson.build b/src/bin/pg_basebackup/meson.build
index aa2dd0538256..c684622bfbb4 100644
--- a/src/bin/pg_basebackup/meson.build
+++ b/src/bin/pg_basebackup/meson.build
@@ -83,7 +83,7 @@ tests += {
     'env': {'GZIP_PROGRAM': gzip.path(),
             'TAR': tar.path(),
             'LZ4': program_lz4.found() ? program_lz4.path() : '',
-            'ZSTD': program_zstd.found() ? program_zstd.path() : ''},
+    },
     'tests': [
       't/010_pg_basebackup.pl',
       't/020_pg_receivewal.pl',
diff --git a/src/bin/pg_dump/meson.build b/src/bin/pg_dump/meson.build
index 0da476a4c34a..ab4c25c7811b 100644
--- a/src/bin/pg_dump/meson.build
+++ b/src/bin/pg_dump/meson.build
@@ -90,6 +90,7 @@ tests += {
     'env': {
       'GZIP_PROGRAM': gzip.path(),
       'LZ4': program_lz4.found() ? program_lz4.path() : '',
+      'with_icu': icu.found() ? 'yes' : 'no',
     },
     'tests': [
       't/001_basic.pl',

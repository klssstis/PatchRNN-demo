From 536d47bd9d5fce8d91929bee3128fa1d08dbcc57 Mon Sep 17 00:00:00 2001
From: Tom Lane <tgl@sss.pgh.pa.us>
Date: Fri, 21 Apr 2017 14:48:29 -0400
Subject: [PATCH] Remove long-obsolete catering for platforms without
 F_SETFD/FD_CLOEXEC.

SUSv2 mandates that <fcntl.h> provide both F_SETFD and FD_CLOEXEC,
so it seems pretty unlikely that any platforms remain without those.
Remove the #ifdef-ery installed by commit 7627b91cd to see if the
buildfarm agrees.

Discussion: https://postgr.es/m/21444.1492798101@sss.pgh.pa.us
---
 src/interfaces/libpq/fe-connect.c | 6 ------
 1 file changed, 6 deletions(-)

diff --git a/src/interfaces/libpq/fe-connect.c b/src/interfaces/libpq/fe-connect.c
index bf4c27c6e232..1b7175d9ef91 100644
--- a/src/interfaces/libpq/fe-connect.c
+++ b/src/interfaces/libpq/fe-connect.c
@@ -74,10 +74,6 @@ static int ldapServiceLookup(const char *purl, PQconninfoOption *options,
 #include "common/ip.h"
 #include "mb/pg_wchar.h"
 
-#ifndef FD_CLOEXEC
-#define FD_CLOEXEC 1
-#endif
-
 
 #ifndef WIN32
 #define PGPASSFILE ".pgpass"
@@ -1987,7 +1983,6 @@ PQconnectPoll(PGconn *conn)
 						continue;
 					}
 
-#ifdef F_SETFD
 					if (fcntl(conn->sock, F_SETFD, FD_CLOEXEC) == -1)
 					{
 						appendPQExpBuffer(&conn->errorMessage,
@@ -1997,7 +1992,6 @@ PQconnectPoll(PGconn *conn)
 						conn->addr_cur = addr_cur->ai_next;
 						continue;
 					}
-#endif   /* F_SETFD */
 
 					if (!IS_AF_UNIX(addr_cur->ai_family))
 					{

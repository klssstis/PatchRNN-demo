From 9d2a464a04846961ffa6b5f2c25b68bc2bf0af67 Mon Sep 17 00:00:00 2001
From: Andres Freund <andres@anarazel.de>
Date: Tue, 4 Apr 2023 21:31:27 -0700
Subject: [PATCH] meson: docs: Allow configuring simple/website style

The meson docs generation hardcoded using the website style so far. Make it
configurable via a meson option.

Reviewed-by: Justin Pryzby <pryzby@telsasoft.com>
Reported-by: Peter Eisentraut <peter.eisentraut@enterprisedb.com>
Discussion: https://postgr.es/m/3fc3bb9b-f7f8-d442-35c1-ec82280c564a@enterprisedb.com
---
 doc/src/sgml/installation.sgml | 12 ++++++++++++
 doc/src/sgml/meson.build       |  7 ++++---
 meson_options.txt              |  3 +++
 3 files changed, 19 insertions(+), 3 deletions(-)

diff --git a/doc/src/sgml/installation.sgml b/doc/src/sgml/installation.sgml
index 0191add03011..f451204854c5 100644
--- a/doc/src/sgml/installation.sgml
+++ b/doc/src/sgml/installation.sgml
@@ -2923,6 +2923,18 @@ ninja install
       </listitem>
      </varlistentry>
 
+     <varlistentry id="configure-docs-html-style">
+      <term><option>-Ddocs_html_style={ simple | website }</option></term>
+      <listitem>
+       <para>
+        Controls which <acronym>CSS</acronym> stylesheet is used.  The default
+        is <literal>simple</literal>.  If set to <literal>website</literal>,
+        the HTML documentation will reference the stylesheet for <ulink
+        url="https://www.postgresql.org/docs/current/">postgresql.org</ulink>.
+       </para>
+      </listitem>
+     </varlistentry>
+
     </variablelist>
    </sect3>
 
diff --git a/doc/src/sgml/meson.build b/doc/src/sgml/meson.build
index 539865da8d94..c6d77b5a1504 100644
--- a/doc/src/sgml/meson.build
+++ b/doc/src/sgml/meson.build
@@ -103,9 +103,10 @@ if xsltproc_bin.found()
     '--tool', xsltproc_bin, '--',
   ]
 
-  xsltproc_html_flags = xsltproc_flags + [
-    '--param', 'website.stylesheet', '1'
-  ]
+  xsltproc_html_flags = xsltproc_flags
+  if get_option('docs_html_style') == 'website'
+    xsltproc_html_flags += ['--param', 'website.stylesheet', '1']
+  endif
 endif
 
 
diff --git a/meson_options.txt b/meson_options.txt
index c203dcce6fe4..5b44a8829d30 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -85,6 +85,9 @@ option('docs', type : 'feature', value: 'auto',
 option('docs_pdf', type : 'feature', value: 'auto',
   description: 'documentation in PDF format')
 
+option('docs_html_style', type : 'combo', choices: ['simple', 'website'],
+  description: 'CSS stylesheet for HTML documentation')
+
 option('dtrace', type : 'feature', value: 'disabled',
   description: 'DTrace support')
 

From 512fc2dd790e3e7c35b3af8cd7586aeb25248c6e Mon Sep 17 00:00:00 2001
From: Tom Lane <tgl@sss.pgh.pa.us>
Date: Thu, 20 Jan 2022 17:32:21 -0500
Subject: [PATCH] Revert "Make configure prefer python3 to plain python."

This reverts commit f201da39edcd6ac1ab9a3edf3e20e2a73bbbe69e.
The buildfarm is not ready for python3, evidently, so we'll
give the owners some more time to get set up.

Discussion: https://postgr.es/m/2872c9a0-4b0a-1354-d5f6-94d6f85ba354@enterprisedb.com
---
 config/python.m4               | 12 +++++++-----
 configure                      |  2 +-
 doc/src/sgml/installation.sgml |  2 +-
 3 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/config/python.m4 b/config/python.m4
index bfcba30262c6..d41aeb2876a4 100644
--- a/config/python.m4
+++ b/config/python.m4
@@ -9,12 +9,14 @@
 # Look for Python and set the output variable 'PYTHON' if found,
 # fail otherwise.
 #
-# Since we are transitioning to supporting only Python 3.x,
-# prefer python3 to plain python.  If the latter exists at all,
-# it very possibly points to python2, which we don't want to
-# select unless it's the only choice.
+# As the Python 3 transition happens and PEP 394 isn't updated, we
+# need to cater to systems that don't have unversioned "python" by
+# default.  Some systems ship with "python3" by default and perhaps
+# have "python" in an optional package.  Some systems only have
+# "python2" and "python3", in which case it's reasonable to prefer the
+# newer version.
 AC_DEFUN([PGAC_PATH_PYTHON],
-[PGAC_PATH_PROGS(PYTHON, [python3 python python2])
+[PGAC_PATH_PROGS(PYTHON, [python python3 python2])
 AC_ARG_VAR(PYTHON, [Python program])dnl
 if test x"$PYTHON" = x""; then
   AC_MSG_ERROR([Python not found])
diff --git a/configure b/configure
index fb4064afa54d..3f2aea0d7dec 100755
--- a/configure
+++ b/configure
@@ -10279,7 +10279,7 @@ fi
 
 if test "$with_python" = yes; then
   if test -z "$PYTHON"; then
-  for ac_prog in python3 python python2
+  for ac_prog in python python3 python2
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
diff --git a/doc/src/sgml/installation.sgml b/doc/src/sgml/installation.sgml
index a5cf0d2657a8..d38f9bc91601 100644
--- a/doc/src/sgml/installation.sgml
+++ b/doc/src/sgml/installation.sgml
@@ -1875,7 +1875,7 @@ build-postgresql:
          language becomes available.  See
          <xref linkend="plpython-python23"/>
          for more information.  If this is not set, the following are probed
-         in this order: <literal>python3 python python2</literal>.
+         in this order: <literal>python python3 python2</literal>.
         </para>
        </listitem>
       </varlistentry>

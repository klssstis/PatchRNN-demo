From 211d80c065626d1a9188188d78ede85d799b93b1 Mon Sep 17 00:00:00 2001
From: Tomas Vondra <tomas.vondra@postgresql.org>
Date: Fri, 6 Jan 2023 14:47:02 +0100
Subject: [PATCH] Fix stale comment about sample_frac adjustment

A comment was left behind referencing sample rate adjustment removed
from 8ad51b5f44. So clean that up. While at it also remove the sample
rate clamping which should not be necessary without the clamping, and
just check that with an assert.

Reported-by: Tom Lane
Discussion: https://postgr.es/m/951485.1672461744%40sss.pgh.pa.us
---
 contrib/postgres_fdw/postgres_fdw.c | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/contrib/postgres_fdw/postgres_fdw.c b/contrib/postgres_fdw/postgres_fdw.c
index 332b4a5cdeb3..f8461bf18dcf 100644
--- a/contrib/postgres_fdw/postgres_fdw.c
+++ b/contrib/postgres_fdw/postgres_fdw.c
@@ -5204,10 +5204,11 @@ postgresAcquireSampleRowsFunc(Relation relation, int elevel,
 			sample_frac = targrows / reltuples;
 
 			/*
-			 * Ensure the sampling rate is between 0.0 and 1.0, even after the
-			 * 10% adjustment above.  (Clamping to 0.0 is just paranoia.)
+			 * We should never get sampling rate outside the valid range
+			 * (between 0.0 and 1.0), because those cases should be covered
+			 * by the previous branch that sets ANALYZE_SAMPLE_OFF.
 			 */
-			sample_frac = Min(1.0, Max(0.0, sample_frac));
+			Assert(sample_frac >= 0.0 && sample_frac <= 1.0);
 		}
 	}
 

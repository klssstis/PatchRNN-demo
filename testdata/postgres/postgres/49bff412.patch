From 49bff412edd9eb226e146f6e4db7b5a8e843bd1f Mon Sep 17 00:00:00 2001
From: Tom Lane <tgl@sss.pgh.pa.us>
Date: Fri, 16 Feb 2018 12:14:08 -0500
Subject: [PATCH] Remove some inappropriate #includes.

Other header files should never #include postgres.h (nor postgres_fe.h,
nor c.h), per project policy.  Also, there's no need for any backend .c
file to explicitly include elog.h or palloc.h, because postgres.h pulls
those in already.

Extracted from a larger patch by Kyotaro Horiguchi.  The rest of the
removals he suggests require more study, but these are no-brainers.

Discussion: https://postgr.es/m/20180215.200447.209320006.horiguchi.kyotaro@lab.ntt.co.jp
---
 src/backend/lib/knapsack.c           | 1 -
 src/backend/replication/basebackup.c | 1 -
 src/backend/utils/misc/pg_config.c   | 1 -
 src/backend/utils/misc/rls.c         | 1 -
 src/include/lib/knapsack.h           | 1 -
 src/pl/plpython/plpy_spi.h           | 1 -
 src/pl/plpython/plpy_util.c          | 1 -
 7 files changed, 7 deletions(-)

diff --git a/src/backend/lib/knapsack.c b/src/backend/lib/knapsack.c
index 25ce4f236549..c7d9c4d8d247 100644
--- a/src/backend/lib/knapsack.c
+++ b/src/backend/lib/knapsack.c
@@ -32,7 +32,6 @@
 #include "nodes/bitmapset.h"
 #include "utils/builtins.h"
 #include "utils/memutils.h"
-#include "utils/palloc.h"
 
 /*
  * DiscreteKnapsack
diff --git a/src/backend/replication/basebackup.c b/src/backend/replication/basebackup.c
index dd7ad64862ae..185f32a5f91a 100644
--- a/src/backend/replication/basebackup.c
+++ b/src/backend/replication/basebackup.c
@@ -34,7 +34,6 @@
 #include "storage/fd.h"
 #include "storage/ipc.h"
 #include "utils/builtins.h"
-#include "utils/elog.h"
 #include "utils/ps_status.h"
 #include "utils/relcache.h"
 #include "utils/timestamp.h"
diff --git a/src/backend/utils/misc/pg_config.c b/src/backend/utils/misc/pg_config.c
index 436d2efb21bf..aa434bc3abbf 100644
--- a/src/backend/utils/misc/pg_config.c
+++ b/src/backend/utils/misc/pg_config.c
@@ -19,7 +19,6 @@
 #include "catalog/pg_type.h"
 #include "common/config_info.h"
 #include "utils/builtins.h"
-#include "utils/elog.h"
 #include "port.h"
 
 Datum
diff --git a/src/backend/utils/misc/rls.c b/src/backend/utils/misc/rls.c
index 5ed64dc1ddc4..94449c7e8a38 100644
--- a/src/backend/utils/misc/rls.c
+++ b/src/backend/utils/misc/rls.c
@@ -22,7 +22,6 @@
 #include "miscadmin.h"
 #include "utils/acl.h"
 #include "utils/builtins.h"
-#include "utils/elog.h"
 #include "utils/lsyscache.h"
 #include "utils/rls.h"
 #include "utils/syscache.h"
diff --git a/src/include/lib/knapsack.h b/src/include/lib/knapsack.h
index f2a61675cb7a..9f17004d48e1 100644
--- a/src/include/lib/knapsack.h
+++ b/src/include/lib/knapsack.h
@@ -8,7 +8,6 @@
 #ifndef KNAPSACK_H
 #define KNAPSACK_H
 
-#include "postgres.h"
 #include "nodes/bitmapset.h"
 
 extern Bitmapset *DiscreteKnapsack(int max_weight, int num_items,
diff --git a/src/pl/plpython/plpy_spi.h b/src/pl/plpython/plpy_spi.h
index d6b0a4707bc5..5a0eef78dcd9 100644
--- a/src/pl/plpython/plpy_spi.h
+++ b/src/pl/plpython/plpy_spi.h
@@ -5,7 +5,6 @@
 #ifndef PLPY_SPI_H
 #define PLPY_SPI_H
 
-#include "utils/palloc.h"
 #include "utils/resowner.h"
 
 extern PyObject *PLy_spi_prepare(PyObject *self, PyObject *args);
diff --git a/src/pl/plpython/plpy_util.c b/src/pl/plpython/plpy_util.c
index 35d57a9e80de..51e2461ec31d 100644
--- a/src/pl/plpython/plpy_util.c
+++ b/src/pl/plpython/plpy_util.c
@@ -8,7 +8,6 @@
 
 #include "mb/pg_wchar.h"
 #include "utils/memutils.h"
-#include "utils/palloc.h"
 
 #include "plpython.h"
 
